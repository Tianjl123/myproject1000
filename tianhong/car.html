<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>car</title>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<link rel="stylesheet" type="text/css" href="css/style9.css"/>
	</head>
	<body>
		<div id="top">
	<div class="margin">
		<div class="top-l">
			<img src="images/wu.png" />
			<img src="images/wei.png" class="c" />
			<img src="images/weibo.png" />
		</div>
		
		<div class="top-r">
			<s>您好，欢迎来到天虹!</s>
			<a href="l.html" target="_blank"><strong>[登录]</strong></a>
			<a href="r.html" target="_blank"><i>[注册]</i></a>
			<span>|</span>
			<b>我的订单</b>
			<span>|</span>
			<b>我的天虹</b>
			<span>|</span>
			<em>客户服务</em>
		</div>
	</div>
</div>
<header class="clear">
	<div class="margin">
		<div class="logo">
			<a href="index.html"><img src="images/logo.jpg" /></a>
		</div>
		<div class="center">
			<div class="sou clear">
				<input type="text" placeholder="自营好货" />
				<p>搜索</p>	
			</div>
			<div class="resou">
				<span>热门搜索:</span>
				<a href="#">Air Jordan</a>
				<a href="#">自营海外好货</a>
				<a href="#">尿裤大趴</a>
				<a href="#">自营好货</a>
				<a href="#">凉夏电器</a>
				<a href="#">跑鞋89元起</a>
				<a href="#">冬季抢购</a>
			</div>
		</div>
		<a href="list.html"><div class="che">
			<span>去商品列表</span>
			<p id="ppp">总价格：0.00</p>
			<i>0</i>
		</div></a>
		
	</div>
</header>
<nav>
	<div class="margin">
		<div class="nav">
			<a href="index.html">首页</a>
			<a>天虹官方APP</a>
			<a>品牌街</a>
			<a>海外购</a>
			<img src="images/new.gif" class="new1"/>
			<img src="images/new.gif" class="new2"/>
		</div>		
	</div>		
</nav>
		<div id="main">
			<div class="margin">
		<table border="1" cellspacing="0" width="1190" align="center">
			<thead>
				<tr>
					<th>图片</th>
					<th>名字</th>
					<th>价格</th>
					<th>数量</th>
					<th>操作</th>
					<th>选择</th>
				</tr>
			</thead>
			<tbody>
				<!--<tr>
					<td><img src=""/></td>
					<td>Data</td>
					<td>Data</td>
					<td>Data</td>
					<td><em>删除</em></td>
				</tr>-->
			</tbody>
		</table>
	</div>
</div>
<footer>
	<div class="margin">
		<div class="zhinan">
			<ul>
				<li><h3>新手指南</h3><a>会员专区</a><a>购物流程</a><a>购物券使用规则</a><a>注册登陆</a>
				</li><li><h3>配送方式</h3><a>配送收费与时效</a><a>商品验收及签收</a></li>
				<li><h3>支付方式</h3><a>发票制度</a><a>在线支付</a><a>天虹品质承诺</a><a>购物卡支付</a>
				</li><li><h3>天虹海外购</h3><a>海外购售后总则</a><a>海外购物小贴士</a><a>天虹品质承诺</a>
				</li><li><h3>售后服务</h3><a>退换货政策</a><a>售后流程及退款</a><a>商品安装与维修</a><a>特殊订单处理公示</a>
				</li><li><h3>客服中心</h3><a>联系客服</a><a>门店地址电话</a><a>常见问题</a>
				</li><li><h3>门店服务</h3><a>全国提供优质服务</a></li>
			</ul>
		</div>
	</div>
</footer>
<div id="bao">
	<div class="margin">
		<div class="bao">
			<a><img src="images/bao1.png"></a><a><img src="images/bao2.png"></a><a><img src="images/bao3.png"></a><a><img src="images/bao4.png"></a><a><img src="images/bao5.png"></a>
		</div>
	</div>
</div>
<div id="fnav">
	<div class="margin">
		<a href="#">大客户服务</a><span>|</span>
		<a href="#">天虹门户</a><span>|</span>
		<a href="#">关于我们</a><span>|</span>
		<a href="#">质量价值保障</a><span>|</span>
		<a href="#">开放平台规则</a><span>|</span>
		<a href="#">友情链接</a><span>|</span>
		<a href="#">品牌招商</a>
	</div>
</div>
<div id="di" class="margin">
	<p>粤ICP备11065574号-7  营业执照　　　Copyright© 虹领巾 2009-2018, All Rights
        Reserved　　　天虹商场股份有限公司 版权所有
    </p>
    <img src="images/di.png" />
</div>
<button class="btn1">全部删除</button>
<button class="btn2">部分删除</button>
</body>
	<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		
		class Car{
			constructor(options){
				this.url = options.url;
				this.body = options.body;
				
				this.load();
				this.dian();
				
			}
			
			load(){
				var that = this;
				$.ajax({
					url:this.url,
					success:function(res){
						that.res = res;
						that.getcookie();
					}
				})
			}
			getcookie(){
				this.goods = JSON.parse($.cookie("goods"))
				this.display();
			}
			display(){
				var str = ""
//				console.log(this.goods)
				if(this.goods!=null){
				this.price3 = 0;
				for(var i=0;i<this.res.food1.length;i++){
					for(var j=0;j<this.goods.length;j++){
						if(this.res.food1[i].goodsId === this.goods[j].id){
									this.price3 += (parseFloat(this.res.food1[i].price1.substr(1)))*(parseFloat(this.goods[j].num)) 
//									console.log(this.price3.toFixed(2))
									this.price4 = this.price3.toFixed(2)
									
							str += `<tr>
										<td><img src="${this.res.food1[i].url}"/></td>
										<td>${this.res.food1[i].name}</td>
										<td>${this.res.food1[i].price1}</td>
										<td><input type="number" value="${this.goods[j].num}"></td>
										<td index="${this.res.food1[i].goodsId}" class="${this.res.food1[i].goodsId}"><em>删除</em></td>
										<td><input type="checkbox" class="check1" /*checked = "checked"*/ /></td>
									</tr>`
						}
					}
				}	
				}
				this.body.html(str)
				if(this.price4){
						$("#ppp").html("总价格："+this.price4)
					}else{						
						$("#ppp").html("总价格：0.00")
					}
				this.changeNum()
				this.remove()
				this.check1();
			}
			check1(){
				var q = 0;
				var that = this;
//				console.log($("#check1").is(':checked'))
				$("tbody").on("click","input",function(){
					if($(".check1").is(':checked')){
						++q;
//							console.log($(this).parent().parent())
							$(this).parent().parent().attr("id","ttt"+q+"")
							$(this).parent().parent().attr("class","ttt")
						}
				})
				
//				$("#check1").attr("")
			}
			changeNum(){
				var that = this;
				this.body.on("input","input",function(){
					that.changeId = $(this).parent().next("td").attr("index");
					that.num = $(this).val();
					that.changeCookie(that.changeId,function(i){
						that.goods[i].num = that.num;
					})				
					that.price3 = 0;
				for(var i=0;i<that.res.food1.length;i++){
					for(var j=0;j<that.goods.length;j++){
						if(that.res.food1[i].goodsId === that.goods[j].id){
									that.price3 += (parseFloat(that.res.food1[i].price1.substr(1)))*(parseFloat(that.goods[j].num)) 
//									console.log(parseFloat(that.res.food1[i].price1.substr(1)))
//									console.log(that.num)
//									console.log(that.price3.toFixed(2))
									that.price4 = that.price3.toFixed(2)									
						}
					}
				}
					$("#ppp").html("总价格："+that.price4)					
				})
			}
			remove(){
				var that = this;
				this.body.on("click","em",function(){
					that.removeId = $(this).parent().attr("index");
					$(this).parent().parent().remove()
					
					that.changeCookie(that.removeId,function(i){
						that.goods.splice(i,1)
					})
					that.price3 = 0;
				for(var i=0;i<that.res.food1.length;i++){
					for(var j=0;j<that.goods.length;j++){
						if(that.res.food1[i].goodsId === that.goods[j].id){
									that.price3 += (parseFloat(that.res.food1[i].price1.substr(1)))*(parseFloat(that.goods[j].num)) 
//									console.log(parseFloat(that.res.food1[i].price1.substr(1)))
//									console.log(that.num)
//									console.log(that.price3.toFixed(2))
									that.price4 = that.price3.toFixed(2)				
						}
					}
				}
					if(that.price4){
						$("#ppp").html("总价格："+that.price4)
					}else{						
						$("#ppp").html("总价格：0.00")
					}
				})
			}
			dian(){
				var that = this
					$(".btn1").click(function(){
						that.setCookie("goods","",-1)
						$("tbody").remove()
					})
					$(".btn2").click(function(){
						console.log($(".ttt").length)
						for(var j=1;j<$(".ttt").length+1;j++){
							that.removeId = $("#ttt"+j+"").children()[4].className
							console.log(that.removeId)
							that.changeCookie(that.removeId,function(i){
							that.goods.splice(i,1)
						})
							
						}
//						that.removeId = $(".ttt").children()[4].className
//						console.log(that.removeId)
//						that.changeCookie(that.removeId,function(i){
//							that.goods.splice(i,1)
//						})
						
					$(".ttt").remove()
					that.check1()
					
						
					})
			}
			
			changeCookie(id,cb){
				for(var i=0;i<this.goods.length;i++){
					if(this.goods[i].id === id){
						cb(i)
					}
				}
				$.cookie("goods",JSON.stringify(this.goods))
			}
setCookie(key,value,n){
	if(n != undefined){
		var d = new Date()
		d.setDate(d.getDate()+n);
//		console.log(d)
		document.cookie = key+"="+ value +";expires="+d;
	}else{
		document.cookie = key+"="+ value;
	}
}
				}	
		new Car({
			url:"http://localhost/tianhong/json/goods.json",
			body:$("tbody")
		})	
	</script>
</html>